<div id="bihar-widget-map-iframe"></div>  <style>#bihar-widget-map-iframe {--bg: #FFFFFF; --card: #FFFFFF; --text: #000000; --muted: #5B6064; --border: #E5E7EB; --primary: #0EA5E9;  --primary-dark: #0284C7; --header-bg: #0EA5E9; --header-text: #FFFFFF; --shadow-sm: 0 1px 2px rgba(0,0,0,0.06); --shadow-md: 0 8px 24px  rgba(0,0,0,0.06); --radius: 12px;}#bihar-widget-map-iframe * {box-sizing: border-box;}#bihar-widget-map-iframe {margin: 0px; font: 16px / 1.5 "Roboto  Slab", "Roboto Serif", Georgia, serif; background: var(--bg); color: var(--text);}#bihar-widget-map-iframe .container {max-width: 1120px; margin: 0px  auto; padding: 0px 16px;}#bihar-widget-map-iframe .main-header {display: none !important;}#bihar-widget-map-iframe .header-content {max-width: 1120px;   margin: 0px auto; padding: 0px 16px; display: flex; justify-content: space-between; align-items: center;}#bihar-widget-map-iframe .header-left  {display: flex; align-items: center; gap: 16px;}#bihar-widget-map-iframe .header-right {display: flex; align-items: center; gap:  16px;}#bihar-widget-map-iframe .menu-icon, #bihar-widget-map-iframe .search-icon, #bihar-widget-map-iframe .account-icon {cursor: pointer; font-size:  18px;}#bihar-widget-map-iframe .site-title {font-size: 18px; font-weight: 600; margin: 0px; letter-spacing: 0.5px;}#bihar-widget-map-iframe  .search-section {padding: 24px 0px 16px;}#bihar-widget-map-iframe .search-controls {display: flex; gap: 12px; align-items: center; margin-bottom: 8px;   flex-wrap: wrap;}#bihar-widget-map-iframe .search-controls label {font-weight: 500; color: var(--text);}#bihar-widget-map-iframe input[type="number"]   {padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; width: 260px; font-size: 16px; min-height: 48px; background: rgb(255, 255,   255);}#bihar-widget-map-iframe input[type="number"]::placeholder {color: var(--muted); opacity: 1;}#bihar-widget-map-iframe  input[type="number"]:focus {outline: none; border-color: var(--primary); box-shadow: rgba(0, 145, 172, 0.1) 0px 0px 0px 2px;}#bihar-widget-map-iframe  .primary-btn {padding: 12px 20px; border: none; border-radius: 10px; background: var(--primary); color: rgb(255, 255, 255); cursor: pointer;  font-size: 16px; font-weight: 600; min-height: 48px;}#bihar-widget-map-iframe .primary-btn:hover {background:  var(--primary-dark);}#bihar-widget-map-iframe .helper-text {color: rgb(153, 153, 153); font-size: 16px; margin-bottom: 8px; font-family: "Roboto  Slab", serif;}#bihar-widget-map-iframe .status-text {color: var(--muted); font-size: 14px;}#bihar-widget-map-iframe .card {background: var(--card);  border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin-bottom: 16px;}#bihar-widget-map-iframe .constituency-header  {margin-bottom: 24px;}#bihar-widget-map-iframe .constituency-title {font-family: "Playfair Display", serif; font-size: 44px; font-weight: 700; margin:   0px 0px 8px; color: var(--text); line-height: 1.1;}#bihar-widget-map-iframe .constituency-info {display: flex; justify-content: space-between;  align-items: center; flex-wrap: wrap; gap: 8px;}#bihar-widget-map-iframe .current-mla-card {margin-bottom: 16px;}#bihar-widget-map-iframe  .current-mla-title {font-family: "Playfair Display", serif; font-size: 22px; font-weight: 600; line-height: 36px; margin: 0px 0px 12px; color:  var(--text);}#bihar-widget-map-iframe .mla-name {font-family: "Roboto Slab", serif; font-size: 16px; font-weight: 400; line-height: 21px; color:  rgb(0, 0, 0); margin: 0px;}#bihar-widget-map-iframe .mla-party {color: var(--muted); font-size: 14px;}#bihar-widget-map-iframe .mla-alliance {color:  var(--muted); font-size: 14px; margin-top: 2px;}#bihar-widget-map-iframe .current-mla-meta {font-family: "Roboto Slab", serif; font-size: 14px;  line-height: 18px; color: rgb(91, 96, 100); margin: 4px 0px 0px;}#bihar-widget-map-iframe .cms-content-card {margin-bottom:  16px;}#bihar-widget-map-iframe .cms-content-title {font-size: 16px; font-weight: 600; margin: 0px 0px 12px; letter-spacing: 0.5px; color:  var(--text);}#bihar-widget-map-iframe .cms-content-body {color: var(--text); line-height: 1.6; font-size: 15px;}#bihar-widget-map-iframe  .cms-placeholder {color: var(--muted); font-style: italic; background: rgb(248, 250, 252); padding: 12px; border-radius: 6px; border: 1px dashed  var(--border);}#bihar-widget-map-iframe .map-section-title {font-family: "Playfair Display", serif; font-size: 32px; font-weight: 600; margin: 0px 0px   6px; color: rgb(0, 0, 0); line-height: 1.15;}#bihar-widget-map-iframe .map-helper {color: rgb(0, 0, 0); font-size: 16px; margin: 0px 0px 12px;  font-family: "Roboto Slab", serif;}#bihar-widget-map-iframe .past-results-title {font-family: "Playfair Display", serif; font-size: 22px; font-weight:   600; line-height: 36px; margin: 0px 0px 12px; color: var(--text);}#bihar-widget-map-iframe .results-container {display: flex; flex-direction: column;   gap: 16px;}#bihar-widget-map-iframe .muted {color: var(--muted);}#bihar-widget-map-iframe .badge {display: inline-block; padding: 2px 8px;  border-radius: 999px; background: rgb(238, 242, 255); border: 1px solid rgb(229, 231, 235); font-size: 12px;}#bihar-widget-map-iframe .pill {display:  inline-block; padding: 2px 8px; border-radius: 999px; color: rgb(255, 255, 255); font-size: 12px;}#bihar-widget-map-iframe .kv {display: grid;  grid-template-columns: 140px 1fr; gap: 6px 12px;}#bihar-widget-map-iframe .section-title {font-weight: 600; margin: 0px 0px  8px;}#bihar-widget-map-iframe .vote-bars {margin-top: 8px;}#bihar-widget-map-iframe .bar {height: 8px; border-radius: 999px; background: rgb(229, 231,   235); position: relative; margin-bottom: 6px;}#bihar-widget-map-iframe .bar > span {position: absolute; left: 0px; top: 0px; bottom: 0px;  border-radius: 999px;}#bihar-widget-map-iframe .bar-label {display: flex; justify-content: space-between; font-size: 12px; margin-bottom:  4px;}#bihar-widget-map-iframe .mono {font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;}#bihar-widget-map-iframe .hr {height: 1px;   background: var(--border); margin: 12px 0px;}#bihar-widget-map-iframe .note {font-size: 12px; color: var(--muted);}#bihar-widget-map-iframe .error  {color: rgb(185, 28, 28);}#bihar-widget-map-iframe .disclaimer-footer {margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border);  text-align: center;}#bihar-widget-map-iframe .disclaimer-text {color: var(--muted); font-size: 11px; line-height: 1.4; font-weight:  400;}#bihar-widget-map-iframe .trends-container {margin: 20px 0px;}#bihar-widget-map-iframe .timeline-scroll {overflow-x: auto; padding: 20px 0px;  scroll-behavior: smooth;}#bihar-widget-map-iframe .timeline-container {display: flex; align-items: center; min-width: max-content; padding: 0px 20px;  gap: 0px; position: relative;}#bihar-widget-map-iframe .timeline-year {display: flex; flex-direction: column; align-items: center; position: relative;   min-width: 170px; padding: 0px 10px;}#bihar-widget-map-iframe .timeline-year-badge {background: var(--primary); color: white; font-weight: 700;  font-size: 16px; padding: 8px 16px; border-radius: 20px; margin-bottom: 16px; box-shadow: rgba(0, 145, 172, 0.3) 0px 2px 8px; position: relative;  z-index: 2;}#bihar-widget-map-iframe .dott {width: 15px; height: 15px; background: rgb(0, 145, 172); margin: 0px auto; border-radius: 50px; border:  2px solid rgb(255, 255, 255);}#bihar-widget-map-iframe .timeline-candidate {text-align: center; margin-bottom: 8px; margin-top:  30px;}#bihar-widget-map-iframe .timeline-candidate-name {font-weight: 600; font-size: 18px; color: var(--text); margin-bottom:  4px;}#bihar-widget-map-iframe .timeline-party {display: inline-block; padding: 4px 10px; border-radius: 12px; color: white; font-size: 12px;  font-weight: 600; box-shadow: rgba(0, 0, 0, 0.15) 0px 2px 4px;}#bihar-widget-map-iframe .timeline-connection {display: flex; align-items: center;  flex-direction: column; min-width: 100px; position: relative;}#bihar-widget-map-iframe .timeline-line {width: 100%; height: 2px; background: rgb(0,  145, 172); position: absolute; margin: 10px 0px; left: 0px; top: 52px;}#bihar-widget-map-iframe .timeline-line::before {content: ""; position:  absolute; top: 50%; right: -4px; transform: translateY(-50%); width: 0px; height: 0px; border-left: 8px solid var(--border); border-top: 4px solid  transparent; border-bottom: 4px solid transparent;}#bihar-widget-map-iframe .timeline-change {display: flex; align-items: center; gap: 6px; padding:  4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-top:  8px;}#bihar-widget-map-iframe .timeline-hold {background: rgb(220, 252, 231); color: rgb(22, 163, 74);}#bihar-widget-map-iframe .timeline-gain  {background: rgb(254, 243, 199); color: rgb(217, 119, 6);}#bihar-widget-map-iframe .timeline-hint {display: none; text-align: center; color:  var(--muted); font-size: 12px; margin-top: 8px; margin-bottom: 4px; font-style: italic;}#bihar-widget-map-iframe .election-result {margin-bottom:  16px;}#bihar-widget-map-iframe .election-title {font-family: "Playfair Display", serif; font-size: 22px; font-weight: 600; line-height: 36px; margin:  0px 0px 12px; color: var(--text);}#bihar-widget-map-iframe #bihar-embed-021 .current-mla-title {font-family: "Playfair Display", serif; font-size:  22px; font-weight: 600; line-height: 36px; margin: 0px 0px 12px; color: var(--text);}#bihar-widget-map-iframe #bihar-dynamic-embed .current-mla-title  {font-family: "Playfair Display", serif; font-size: 22px; font-weight: 600; line-height: 36px; margin: 0px 0px 12px; color:  var(--text);}#bihar-widget-map-iframe .candidate-row {margin-bottom: 16px;}#bihar-widget-map-iframe .candidate-info {display: flex; justify-content:  space-between; align-items: center; margin-bottom: 8px;}#bihar-widget-map-iframe .candidate-name {font-family: "Roboto Slab", serif; font-weight: 400;   font-size: 16px; padding-bottom: 8px;}#bihar-widget-map-iframe .candidate-party {color: var(--muted); font-size: 14px;}#bihar-widget-map-iframe  .vote-count {font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-weight: 600;}#bihar-widget-map-iframe .margin-info  {margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);}#bihar-widget-map-iframe .margin-text {font-family: "Roboto Slab", serif;  font-weight: 700; font-size: 12px;}@media (max-width: 767px){#bihar-widget-map-iframe .current-mla-title {font-size: 20px;}#bihar-widget-map-iframe  #bihar-embed-021 .current-mla-title {font-size: 20px;}#bihar-widget-map-iframe #bihar-dynamic-embed .current-mla-title {font-size:  20px;}#bihar-widget-map-iframe .timeline-scroll {padding: 16px 0px; scroll-snap-type: x mandatory;}#bihar-widget-map-iframe .timeline-container  {padding: 0px 16px;}#bihar-widget-map-iframe .timeline-year {min-width: 100px; padding: 0px 8px; scroll-snap-align: center;}#bihar-widget-map-iframe  .timeline-year-badge {font-size: 14px; padding: 6px 12px; margin-bottom: 12px;}#bihar-widget-map-iframe .timeline-candidate-name {font-size:  12px;}#bihar-widget-map-iframe .timeline-party {font-size: 11px; padding: 3px 8px;}#bihar-widget-map-iframe .timeline-connection {min-width:  80px;}#bihar-widget-map-iframe .timeline-line {top: 41px;}#bihar-widget-map-iframe .timeline-change {font-size: 10px; padding: 3px  6px;}#bihar-widget-map-iframe .timeline-hint {display: block;}}@media (min-width: 768px){#bihar-widget-map-iframe .container {padding: 0px  24px;}#bihar-widget-map-iframe .search-controls {gap: 16px;}#bihar-widget-map-iframe .results-container {display: grid; grid-template-columns: 1fr  1fr; gap: 20px;}#bihar-widget-map-iframe .constituency-title {font-size: 28px;}}@media (min-width: 1024px){#bihar-widget-map-iframe .results-container   {grid-template-columns: 1fr 1fr 1fr;}#bihar-widget-map-iframe .header-content {padding: 0px 24px;}#bihar-widget-map-iframe .constituency-title  {font-size: 32px;}}</style>  <script>
// Global shared data cache for Bihar widgets - prevents redundant fetches within page load
if (!window.biharWidgetDataCache) {
  window.biharWidgetDataCache = {
    cache: {},
    pending: {},
    fetchCsv: function(url) {
      if (this.cache[url]) {
        return Promise.resolve(this.cache[url]);
      }
      if (this.pending[url]) {
        return this.pending[url];
      }
      var self = this;
      this.pending[url] = fetch(url, { cache: 'no-cache' })
        .then(function(response) { return response.text(); })
        .then(function(text) {
          self.cache[url] = text;
          delete self.pending[url];
          return text;
        })
        .catch(function(error) {
          delete self.pending[url];
          throw error;
        });
      return this.pending[url];
    }
  };
}

  (function() {    var hasRendered = false;    var isFetching = false;    var renderAttempts = 0;    var maxAttempts = 3;    function initEmbed() {      try {        renderAttempts++;        var parentUrl = '';        try { parentUrl = window.parent.location.href; } catch(e) { parentUrl = document.referrer || window.location.href; }        var hostEl = document.getElementById('bihar-widget-map-iframe');        if (!hostEl) {          if (renderAttempts < maxAttempts) setTimeout(initEmbed, 500);          return;        }        if (hasRendered && hostEl.querySelector('iframe')) return;        if (isFetching) return;        isFetching = true;        hostEl.innerHTML = '<div style="height:600px;display:flex;align-items:center;justify-content:center;color:#666;">Loading map...</div>';        function extractSlug(url) {          try {            var urlObj = new URL(url);            var path = urlObj.pathname;            var match = path.match(/\/([^\/]+?)(?:-assembly)?-election-\d{4}/i);            if (match && match[1]) return match[1];            var parts = path.split('/').filter(function(p){ return p.length > 0; });            if (parts.length > 1) {              var lastPart = parts[parts.length - 1];              var cleaned = lastPart.replace(/-\d{4}-\d+$/, '').replace(/-assembly-election.*$/, '').replace(/-election.*$/, '');              if (cleaned) return cleaned;            }            return null;          } catch(e) { return null; }        }        function detectDataSource() {          var host = window.location.hostname.toLowerCase();          if (host.includes('quintype.io') || host.includes('sandbox')) return 'sandbox';          return 'github';        }        var slug = extractSlug(parentUrl);        if (!slug) {          hostEl.innerHTML = '<div style="padding:20px;color:#b91c1c;">Could not extract constituency from URL</div>';          isFetching = false;          return;        }        var dataSource = detectDataSource();        var filesConfig = {          github: { consolidated: 'https://suhastpml.github.io/Bihar_constituency_page/bihar_election_results_consolidated.json' },          sandbox: { consolidated: 'https://dh-sandbox-web.quintype.io/bihar_election_results_consolidated' }        };        var FILES = filesConfig[dataSource];        // Direct CSV sources (shared with iframe)
        var PARTIES_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTkIPquNELhk-ox7P7qIrBu4WhxOAGb94ILzfSwEAJ-OMAXV9Dpz4k0RlZH5Hc8F0DJPUHP2ALDNfIb/pub?gid=2137025522&single=true&output=csv';
        var RESULTS_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR8Owt5cYAhwo6k6ggprd7Pp2kT3RiV5-5XsSUFVSXG4oOu3Cc64emjWWMjSruwXfi_33Z24S4muAOY/pub?gid=1572654813&single=true&output=csv';
        var ALLIANCES_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRiy0B0zY2ej1u0orjS8L1_TWWKC5ld5Ccaq4yALRV0IqtB8RdGdP8fI6mdYQCQgNftRR8slvwKmjJp/pub?gid=0&single=true&output=csv';
        function parseCsv(text){
    var lines = text.replace(/\r\n?/g,'\n').split('\n');
    if (!lines.length) return [];
    var header = lines.shift().split(',').map(function(s){return s.trim();});
    var rows = [];
    lines.forEach(function(line){
      if (!line) return;
      var cells = [];
      // CMS-safe CSV parser - character by character to avoid regex quote issues
      var QUOTE = '"';
      var COMMA = ',';
      var cell = '';
      var inQuotes = false;
      for (var i = 0; i < line.length; i++) {
        var ch = line.charAt(i);
        if (ch === QUOTE) {
          inQuotes = !inQuotes;
        } else if (ch === COMMA && !inQuotes) {
          cells.push(cell.trim());
          cell = '';
        } else {
          cell += ch;
        }
      }
      cells.push(cell.trim());
      if (!cells.length) return;
      var obj = {};
      for (var i=0;i<header.length;i++){ obj[header[i]] = cells[i]===undefined? '' : cells[i]; }
      rows.push(obj);
    });
    return rows;
  }
        // Fetch all 3 CSVs from cache to pass to iframe
        Promise.all([
          window.biharWidgetDataCache.fetchCsv(PARTIES_CSV),
          window.biharWidgetDataCache.fetchCsv(RESULTS_CSV),
          window.biharWidgetDataCache.fetchCsv(ALLIANCES_CSV).catch(function(){ return ''; })
        ]).then(function(csvTexts){
          var partiesText = csvTexts[0];
          var resultsText = csvTexts[1];
          var alliancesText = csvTexts[2];
          var consolidated = parseCsv(resultsText);
          var constituency = null;
          var urlLower = parentUrl.toLowerCase();
          for (var i = 0; i < consolidated.length; i++) {
            var constName = (consolidated[i].constituency_name || '').toLowerCase().replace(/\s+/g, '-');
            if (constName && urlLower.includes(constName)) { constituency = consolidated[i]; break; }
          }
          if (!constituency) {
            for (var j = 0; j < consolidated.length; j++) {
              if (consolidated[j].slug === slug) { constituency = consolidated[j]; break; }
            }
          }
          if (!constituency) {
            hostEl.innerHTML = '<div style="padding:20px;color:#b91c1c;">Constituency not found</div>';
            isFetching = false;
            return;
          }
          var name = encodeURIComponent((constituency.constituency_name || constituency.name || '').toString());
          var src = (dataSource === 'sandbox') ? ('/Bihar_map_csv?name=' + name) : ('https://suhastpml.github.io/Bihar_constituency_page/map.html?name=' + name);
          var iframe = document.createElement('iframe');
          iframe.className = 'embed-map';
          iframe.loading = 'lazy';
          iframe.referrerPolicy = 'no-referrer';
          iframe.style.width = '100%';
          iframe.style.height = '600px';
          iframe.style.border = '0';
          iframe.style.borderRadius = '8px';
          iframe.src = src;
          // Send cached data to iframe via postMessage
          iframe.onload = function() {
            try {
              iframe.contentWindow.postMessage({
                type: 'biharElectionData',
                parties: partiesText,
                results: resultsText,
                alliances: alliancesText
              }, '*');
            } catch(e) {
              console.warn('Failed to send data to iframe:', e);
            }
          };
          hostEl.innerHTML = '';
          hostEl.appendChild(iframe);
          hasRendered = true;
          isFetching = false;
        }).catch(function(){
          hostEl.innerHTML = '<div style="padding:20px;color:#b91c1c;">Error loading map</div>';
          isFetching = false;
        });      } catch(e) {        isFetching = false;        if (renderAttempts < maxAttempts) setTimeout(initEmbed, 500);      }    }    if (document.readyState === 'loading') {      document.addEventListener('DOMContentLoaded', initEmbed);    } else {      initEmbed();    }    setTimeout(initEmbed, 100);    setTimeout(initEmbed, 500);    window.addEventListener('load', initEmbed);  })();  </script>